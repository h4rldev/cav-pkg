build_folder := "./build"
build_script := build_folder / "build.sh"
bin_folder := build_folder / "bin"

default:
  just --list

@fix-perms:
  chmod +x {{build_script}}

@compile target="both" args="": fix-perms
  {{build_script}} -c {{args}}

@link name="cav": fix-perms
  {{build_script}} -l {{name}} 

@build target name="cav":
  just compile {{target}}
  just link {{name}}

@run args="" name="cav":
	just compile
	just link {{name}}
	{{bin_folder}}/{{name}} {{args}}

@debug args="":
  just compile --debug
  just link
  valgrind ./build/bin/cav {{args}}
